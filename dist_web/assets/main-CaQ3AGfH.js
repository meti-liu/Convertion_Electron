import{_ as W,u as G,r as p,c as Z,w as O,o as de,a as ye,b,d as z,e as y,f as S,t as E,g as we,n as xe,h as ve,F as H,i as q,j as n,k as i,l as s,E as B,m as be,z as Pe,p as ie,q as ue,s as ke,v as Se,x as Ce,y as ze,A as Fe,B as Ae,C as Ie,D as ce,G as j,H as Me,I as J,J as De,K as $e,L as Te,M as Le,N as Xe,O as Ye,P as Re}from"./index-Br527wYi.js";const Be={class:"chart-container-svg"},Ee={class:"chart-title"},Ve=["viewBox"],Ne=["transform"],Ze=["d","stroke","stroke-width"],je=["cx","cy","r","fill","stroke","stroke-width"],Ue=["x","y","width","height"],We={class:"zoom-controls"},Ge={class:"zoom-slider-container"},Je={__name:"JigChart_svg",props:{chartData:{type:Object,required:!0},title:{type:String,default:"Jig Chart"},highlightedPinIds:{type:Array,default:()=>[]},selectedPinId:{type:[String,Number],default:null},pinToZoom:{type:Object,default:null}},setup(V){const{t:_}=G(),w=V;p({x:0,y:0});const x=p(null),d=p({minX:0,minY:0,width:1,height:1}),u=p(1),v=p(0),h=p(0),M=p("pan"),$=p(!1),D=p(!1),F=p({x:0,y:0}),A=p({x:0,y:0,width:0,height:0}),o=p([]),f=p([]),c=p(1);let g=null;const C=Z(()=>`${d.value.minX} ${d.value.minY} ${d.value.width} ${d.value.height}`),X=Z(()=>`translate(${v.value}, ${h.value}) scale(${u.value})`),Y=Z(()=>w.chartData?.datasets?.filter(e=>e.type==="line").map(e=>({...e,path:e.data.map((t,a)=>(a===0?"M":"L")+`${t.x} ${t.y}`).join(" ")}))||[]),m=Z(()=>{const e=[];return w.chartData?.datasets?.filter(t=>t.type==="scatter").forEach(t=>{t.data.forEach(a=>{const l=w.highlightedPinIds.includes(a.id),r=w.selectedPinId===a.id;e.push({...a,color:r?"white":l?"red":t.backgroundColor,radius:l||r?T.value*4:T.value,stroke:l||r?"darkred":"none",strokeWidth:l||r?T.value/2:0})})}),e}),T=Z(()=>.25/Math.sqrt(u.value)),L=Z(()=>.5/Math.sqrt(u.value));O(()=>w.pinToZoom,e=>{e?pe(e):(o.value.length>1||u.value!==1||v.value!==0||h.value!==0)&&ee()}),O(()=>w.chartData,e=>{if(!e||!e.datasets||e.datasets.length===0)return;let t=1/0,a=1/0,l=-1/0,r=-1/0;if(e.datasets.forEach(P=>{P.data.forEach(k=>{k.x<t&&(t=k.x),k.y<a&&(a=k.y),k.x>l&&(l=k.x),k.y>r&&(r=k.y)})}),isFinite(t)){const P=(l-t)*.1||10;d.value={minX:t-P,minY:a-P,width:l-t+P*2,height:r-a+P*2},ee()}},{deep:!0,immediate:!0});function U(e){const t=x.value;if(!t)return{x:0,y:0};const a=t.createSVGPoint();return a.x=e.clientX,a.y=e.clientY,a.matrixTransform(t.getScreenCTM().inverse())}function K(e){const a=e.deltaY<0?u.value*1.1:u.value/1.1,l=U(e);v.value=l.x-(l.x-v.value)*(a/u.value),h.value=l.y-(l.y-h.value)*(a/u.value),u.value=a,c.value=a,N()}function I(e){if(M.value==="pan")$.value=!0,F.value={x:e.clientX,y:e.clientY};else if(M.value==="zoom"){D.value=!0;const t=U(e);F.value=t,A.value={x:t.x,y:t.y,width:0,height:0}}}function Q(e){if($.value){const t=x.value;if(!t)return;const a=t.getScreenCTM(),l=(e.clientX-F.value.x)/a.a,r=(e.clientY-F.value.y)/a.d;v.value+=l,h.value+=r,F.value={x:e.clientX,y:e.clientY}}else if(D.value){const t=U(e),a=Math.min(t.x,F.value.x),l=Math.min(t.y,F.value.y),r=Math.abs(t.x-F.value.x),P=Math.abs(t.y-F.value.y);A.value={x:a,y:l,width:r,height:P}}}function R(){if(D.value){const e=A.value;if(e.width>5&&e.height>5){const a=u.value*2,l=e.x+e.width/2,r=e.y+e.height/2;v.value=v.value-(l-v.value)*1,h.value=h.value-(r-h.value)*1,u.value=a,c.value=a,N()}}else $.value&&N();$.value=!1,D.value=!1,A.value={width:0,height:0}}function te(e){g&&clearTimeout(g);const t=parseFloat(e.target.value);c.value=t,g=setTimeout(()=>{const a=u.value,l=t,r=d.value.minX+d.value.width/2,P=d.value.minY+d.value.height/2;v.value=r-(r-v.value)*(l/a),h.value=P-(P-h.value)*(l/a),u.value=l,N()},50)}function ae(e){M.value=e}function le(e){const t=c.value+e,a=Math.max(1,Math.min(20,t));if(Math.abs(a-c.value)<1e-6)return;c.value=a;const l=u.value,r=a,P=d.value.minX+d.value.width/2,k=d.value.minY+d.value.height/2;v.value=P-(P-v.value)*(r/l),h.value=k-(k-h.value)*(r/l),u.value=r,N()}function ee(){u.value=1,v.value=0,h.value=0,c.value=1,N(!0)}function N(e=!1){const t={scale:u.value,translateX:v.value,translateY:h.value};if(e)o.value=[t],f.value=[];else{const a=o.value[o.value.length-1];JSON.stringify(a)!==JSON.stringify(t)&&(o.value.push(t),f.value=[])}}function ne(e){u.value=e.scale,v.value=e.translateX,h.value=e.translateY,oe()}function he(){if(o.value.length>1){const e=o.value.pop();f.value.push(e),ne(o.value[o.value.length-1])}}function fe(){if(f.value.length>0){const e=f.value.pop();o.value.push(e),ne(e)}}function pe(e){const a={x:e.x,y:e.y},l=d.value.minX+d.value.width/2,r=d.value.minY+d.value.height/2;u.value=8,v.value=l-a.x*8,h.value=r-a.y*8,N(),oe()}function oe(){const e=Math.log(u.value)/Math.log(1.4)+1;c.value=Math.max(1,Math.min(20,e))}function _e(){if(!x.value)return;const e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("xmlns",e),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.setAttribute("version","1.1"),t.setAttribute("width","800"),t.setAttribute("height","600"),t.setAttribute("viewBox",x.value.getAttribute("viewBox"));const a=document.createElementNS(e,"rect");a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("fill","#000000"),t.appendChild(a);const l=document.createElementNS(e,"style");l.setAttribute("type","text/css"),l.textContent=`
    .drag-rect {
      fill: rgba(52, 152, 219, 0.1);
      stroke: rgba(52, 152, 219, 0.7);
      stroke-width: 0.5;
      stroke-dasharray: 2 2;
    }
    path {
      fill: none;
    }
    svg {
      background-color: #000000;
    }
  `,t.appendChild(l);const r=x.value.querySelector("g");if(r){const ge=r.cloneNode(!0);t.appendChild(ge)}let k=new XMLSerializer().serializeToString(t);k=k.replace(/\sclass="[^"]*"/g,"");const me=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
`+k;window.electronAPI&&window.electronAPI.exportSvg(me)}let se=null;return de(()=>{window.electronAPI&&(se=e=>{e.success?ce.success(e.message||_("export_success")||"导出成功"):ce.error(e.message||_("export_error")||"导出失败")},window.electronAPI.onExportSvgResult(se))}),ye(()=>{}),(e,t)=>{const a=b("el-icon");return y(),z("div",Be,[S("div",Ee,E(V.title),1),(y(),z("svg",{ref_key:"svgRef",ref:x,class:xe(["chart-svg",{"cursor-pan":M.value==="pan","cursor-zoom":M.value==="zoom"}]),viewBox:C.value,onWheel:we(K,["prevent"]),onMousedown:I,onMousemove:Q,onMouseup:R,onMouseleave:R},[S("g",{transform:X.value},[(y(!0),z(H,null,q(Y.value,(l,r)=>(y(),z("path",{key:`rut-${r}`,d:l.path,stroke:l.borderColor,"stroke-width":L.value,fill:"none"},null,8,Ze))),128)),(y(!0),z(H,null,q(m.value,(l,r)=>(y(),z("circle",{key:`pin-${r}`,cx:l.x,cy:l.y,r:l.radius,fill:l.color,stroke:l.stroke,"stroke-width":l.strokeWidth},null,8,je))),128))],8,Ne),D.value?(y(),z("rect",{key:0,x:A.value.x,y:A.value.y,width:A.value.width,height:A.value.height,class:"drag-rect"},null,8,Ue)):ve("",!0)],42,Ve)),S("div",We,[n(s(ie),null,{default:i(()=>[n(s(B),{onClick:t[0]||(t[0]=l=>ae("pan")),type:M.value==="pan"?"primary":"default",title:s(_)("pan_mode"),size:"small"},{default:i(()=>[n(a,null,{default:i(()=>[n(s(be))]),_:1})]),_:1},8,["type","title"]),n(s(B),{onClick:t[1]||(t[1]=l=>ae("zoom")),type:M.value==="zoom"?"primary":"default",title:s(_)("zoom_mode"),size:"small"},{default:i(()=>[n(a,null,{default:i(()=>[n(s(Pe))]),_:1})]),_:1},8,["type","title"])]),_:1}),n(s(ue),{direction:"vertical"}),n(s(ie),null,{default:i(()=>[n(s(B),{onClick:he,disabled:o.value.length<=1,title:s(_)("undo"),size:"small"},{default:i(()=>[n(a,null,{default:i(()=>[n(s(ke))]),_:1})]),_:1},8,["disabled","title"]),n(s(B),{onClick:fe,disabled:f.value.length===0,title:s(_)("redo"),size:"small"},{default:i(()=>[n(a,null,{default:i(()=>[n(s(Se))]),_:1})]),_:1},8,["disabled","title"]),n(s(B),{onClick:ee,title:s(_)("reset_view"),size:"small"},{default:i(()=>[n(a,null,{default:i(()=>[n(s(Ce))]),_:1})]),_:1},8,["title"]),n(s(B),{onClick:_e,title:s(_)("export_svg")||"导出SVG",size:"small"},{default:i(()=>[n(a,null,{default:i(()=>[n(s(ze))]),_:1})]),_:1},8,["title"])]),_:1}),n(s(ue),{direction:"vertical"}),S("div",Ge,[n(s(B),{onClick:t[2]||(t[2]=l=>le(-1)),title:s(_)("zoom_out"),size:"small"},{default:i(()=>[n(a,null,{default:i(()=>[n(s(Fe))]),_:1})]),_:1},8,["title"]),n(s(Ae),{modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=l=>c.value=l),min:1,max:20,step:.1,onInput:te,class:"zoom-slider",title:s(_)("zoom_level"),size:"small"},null,8,["modelValue","title"]),n(s(B),{onClick:t[4]||(t[4]=l=>le(1)),title:s(_)("zoom_in"),size:"small"},{default:i(()=>[n(a,null,{default:i(()=>[n(s(Ie))]),_:1})]),_:1},8,["title"])])])])}}},re=W(Je,[["__scopeId","data-v-4407177c"]]),Oe={class:"card-header"},He={__name:"ControlPanel",setup(V){const{t:_}=G();return(w,x)=>{const d=b("el-card");return y(),j(d,{class:"control-panel",shadow:"hover"},{header:i(()=>[S("div",Oe,[S("h3",null,E(s(_)("controls")),1)])]),default:i(()=>[Me(w.$slots,"default",{},void 0,!0)]),_:3})}}},qe=W(He,[["__scopeId","data-v-c1a09686"]]),Ke={class:"pin-inspector"},Qe={class:"controls"},et={key:1,class:"logs-container"},tt={key:1},at={key:0,class:"failed-pins"},lt={class:"pins-grid"},nt={__name:"PinInspector",props:{failData:{type:Array,default:()=>[]}},emits:["highlight-pins","select-pin"],setup(V,{emit:_}){const{t:w}=G(),x=V,d=_,u=p([]),v=p(0),h=p(null),M=o=>{h.value===o?h.value=null:h.value=o,d("select-pin",h.value)},$=o=>{v.value=parseInt(o),A()},D=Z(()=>u.value[v.value]||null);O(()=>x.failData,o=>{o&&o.length>0&&(u.value=o,v.value=0,A())},{immediate:!0});const F=async()=>{const o=await window.electronAPI.processFailLogs();if(o&&o.length>0){const f=new Set(u.value.map(g=>g.id)),c=o.filter(g=>!f.has(g.id));if(c.length>0)u.value.push(...c),v.value=u.value.length-c.length;else if(o.length>0){const g=u.value.findIndex(C=>C.id===o[0].id);g!==-1&&(v.value=g)}}},A=()=>{D.value&&d("highlight-pins",D.value.failedPins||[])};return(o,f)=>{const c=b("el-icon"),g=b("el-button"),C=b("el-empty"),X=b("el-badge"),Y=b("el-input"),m=b("el-tag"),T=b("el-divider"),L=b("el-scrollbar"),U=b("el-tab-pane"),K=b("el-tabs");return y(),z("div",Ke,[S("div",Qe,[n(g,{type:"primary",onClick:F,class:"action-button"},{default:i(()=>[n(c,null,{default:i(()=>[n(s(De))]),_:1}),J(" "+E(s(w)("load_fail_logs")),1)]),_:1})]),u.value.length===0?(y(),j(C,{key:0,description:s(w)("no_logs_loaded")},null,8,["description"])):(y(),z("div",et,[n(K,{modelValue:v.value,"onUpdate:modelValue":f[0]||(f[0]=I=>v.value=I),type:"card",class:"log-tabs",onTabChange:$},{default:i(()=>[(y(!0),z(H,null,q(u.value,(I,Q)=>(y(),j(U,{key:I.id,label:I.name,name:Q.toString()},{label:i(()=>[I.failedPins.length>0?(y(),j(X,{key:0,value:I.failedPins.length,max:99,type:"danger"},{default:i(()=>[J(E(I.name),1)]),_:2},1032,["value"])):(y(),z("span",tt,E(I.name),1))]),default:i(()=>[n(Y,{"model-value":I.content,type:"textarea",rows:8,readonly:"",class:"csv-content-area"},null,8,["model-value"]),I.failedPins.length>0?(y(),z("div",at,[n(T,{"content-position":"left"},{default:i(()=>[n(m,{type:"danger"},{default:i(()=>[J(E(s(w)("failed_pins")),1)]),_:1})]),_:1}),n(L,{height:"150px"},{default:i(()=>[S("div",lt,[(y(!0),z(H,null,q(I.failedPins,R=>(y(),j(m,{key:R,class:"pin-item",type:h.value===R?"danger":"info",effect:h.value===R?"dark":"light",onClick:te=>M(R),size:"large"},{default:i(()=>[J(E(R),1)]),_:2},1032,["type","effect","onClick"]))),128))])]),_:2},1024)])):ve("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]))])}}},ot=W(nt,[["__scopeId","data-v-7efc5e31"]]),st={class:"language-switcher"},it={__name:"LanguageSwitcher",setup(V){const{locale:_}=G();return O(_,w=>{window.electronAPI.setLocale(w)}),(w,x)=>(y(),z("div",st,[$e(S("select",{"onUpdate:modelValue":x[0]||(x[0]=d=>Le(_)?_.value=d:null)},x[1]||(x[1]=[S("option",{value:"en"},"English",-1),S("option",{value:"zh-CN"},"简体中文",-1),S("option",{value:"zh-TW"},"繁體中文",-1),S("option",{value:"ja"},"日本語",-1)]),512),[[Te,s(_)]])]))}},ut=W(it,[["__scopeId","data-v-503b3d0c"]]),ct={class:"header-content"},rt={class:"title"},dt={__name:"App",setup(V){const{t:_}=G(),w=p({datasets:[]}),x=p({datasets:[]}),d=p([]),u=p(null),v=p(null),h=p(null),M=p([]),$=p([]);function D(o){if(console.log("[App.vue] updateChartData called with:",o),o&&o.rut_data){const{rut_data:f,adr_data:c}=o,g=f.filter(m=>m.filename.toUpperCase().includes("TOP")),C=f.filter(m=>m.filename.toUpperCase().includes("BOT")),X=g.map((m,T)=>({label:m.filename,data:m.coords.map(L=>({x:L[0],y:L[1]})),borderColor:["#FF5733","#FFD700","#00FFFF"][T%3],borderWidth:2,showLine:!0,fill:!1,type:"line",pointRadius:0}));c?.side_a&&X.push({label:"ADR Pins - Side A",data:c.side_a.map(m=>({...m,id:m.no})),backgroundColor:"#00FF00",pointRadius:1,type:"scatter"}),w.value={datasets:X};const Y=C.map((m,T)=>({label:m.filename,data:m.coords.map(L=>({x:L[0],y:L[1]})),borderColor:["#FF5733","#FFD700","#00FFFF"][T%3],borderWidth:2,showLine:!0,fill:!1,type:"line",pointRadius:0}));c?.side_b&&Y.push({label:"ADR Pins - Side B",data:c.side_b.map(m=>({...m,id:m.no})),backgroundColor:"#00FF00",pointRadius:1,type:"scatter"}),x.value={datasets:Y}}else console.error("[App.vue] updateChartData received invalid or empty data.")}de(()=>{console.log("[App.vue] Component is mounted. Setting up listeners."),window.electronAPI?(window.electronAPI.onJigDataLoaded(o=>{console.log("[App.vue] Received jig-data-loaded event. Data:",o),D(o)}),window.electronAPI.onFailDataLoaded(o=>{console.log("[App.vue] Received fail-data-loaded event. Data:",o),$.value=o;const f=o.flatMap(c=>c.failedPins);M.value=[...new Set(f)]})):console.error("[App.vue] electronAPI is not available on mount.")});function F(o){d.value=o}function A(o){if(u.value=o,v.value=null,h.value=null,o){let f=null,c=null;for(const g of w.value.datasets)if(g.type==="scatter"&&(f=g.data.find(C=>C.id===o),f)){c="top";break}if(!f){for(const g of x.value.datasets)if(g.type==="scatter"&&(f=g.data.find(C=>C.id===o),f)){c="bot";break}}c==="top"?v.value=f:c==="bot"&&(h.value=f)}}return(o,f)=>{const c=b("el-header"),g=b("el-aside"),C=b("el-col"),X=b("el-row"),Y=b("el-main"),m=b("el-container");return y(),j(m,{id:"app-container"},{default:i(()=>[n(c,{height:"auto",class:"app-header"},{default:i(()=>[S("div",ct,[S("h1",rt,E(s(_)("app_title")),1),n(ut)])]),_:1}),n(m,{class:"main-container"},{default:i(()=>[n(g,{width:"300px",class:"controls-sidebar"},{default:i(()=>[n(qe,null,{default:i(()=>[n(ot,{onHighlightPins:F,onSelectPin:A,failedPins:M.value,failData:$.value},null,8,["failedPins","failData"])]),_:1})]),_:1}),n(Y,{class:"charts-container"},{default:i(()=>[n(X,{gutter:20},{default:i(()=>[n(C,{span:12},{default:i(()=>[n(re,{chartData:w.value,highlightedPinIds:d.value,selectedPinId:u.value,pinToZoom:v.value,title:s(_)("top_jig_side_a")},null,8,["chartData","highlightedPinIds","selectedPinId","pinToZoom","title"])]),_:1}),n(C,{span:12},{default:i(()=>[n(re,{chartData:x.value,highlightedPinIds:d.value,selectedPinId:u.value,pinToZoom:h.value,title:s(_)("bottom_jig_side_b")},null,8,["chartData","highlightedPinIds","selectedPinId","pinToZoom","title"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},vt=W(dt,[["__scopeId","data-v-0515d3a9"]]);Xe(vt).use(Ye).use(Re).mount("#app");
